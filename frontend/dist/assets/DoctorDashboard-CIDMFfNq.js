import{a as r,j as e,f as C,B as f,C as D,c as P}from"./index-nTQIyIYe.js";import{B as c,C as A}from"./button-C8d14KLS.js";import{Q as a}from"./react-toastify.esm-UE-0H8Ct.js";import{P as R}from"./PrescriptionForm-4hZsIAJW.js";import"./hospitalApi-BvT66DJ5.js";const T=()=>{const[i,g]=r.useState(""),[l,d]=r.useState([]),[n,m]=r.useState(!1),[B,x]=r.useState(!1),p="0xaCA3eF3906639995Fb31Bd58dbcDD0d3CFa2abE8",j=async()=>{if(!window.ethereum)return a.error("Please install MetaMask.");const o=await new f(window.ethereum).send("eth_requestAccounts",[]);g(o[0]),a.success("Wallet connected successfully!")},w=async()=>{try{if(m(!0),!window.ethereum){a.error("No Ethereum provider found. Please connect your wallet.");return}const o=await new f(window.ethereum).getSigner(),y=new D(p,P,o);let u=[];try{u=await y.getAllRecords()}catch(s){console.error("Contract call failed",s),a.error("Failed to query on-chain records.");return}const N=u.map((s,v)=>({id:v+1,patient:s.patient,diagnosis:s.diagnosis,prescription:s.prescription,date:new Date(Number(s.timestamp)*1e3).toLocaleString()}));d(N)}catch(t){console.error("Error fetching records:",t),a.error("Failed to fetch patient records.")}finally{m(!1)}},h=async()=>{try{const t=await C.get("/api/hospital/patients");Array.isArray(t.data)&&d(t.data)}catch{}},b=()=>{navigator.clipboard.writeText(i),x(!0),a.success("Wallet address copied!"),setTimeout(()=>x(!1),2e3)};return r.useEffect(()=>{},[]),r.useEffect(()=>{h()},[]),e.jsxs("div",{className:"p-6 min-h-screen bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-blue-700",children:"ðŸ‘¨â€âš•ï¸ Doctor Dashboard"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-sm text-gray-600 truncate max-w-[180px]",children:i||"Not Connected"}),i?e.jsx(c,{onClick:b,variant:"outline",size:"icon",children:e.jsx(A,{size:16})}):e.jsx(c,{onClick:j,variant:"solid",children:"Connect Wallet"})]})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx(c,{onClick:w,disabled:n,children:n?"Loading Records...":"View Patient Records"}),e.jsx(c,{onClick:h,variant:"outline",children:"Refresh Patients (Backend)"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(t=>e.jsxs("div",{className:"bg-white rounded-xl shadow p-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800",children:["Patient: ",t.patient.slice(0,6),"...",t.patient.slice(-4)]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("strong",{children:"Diagnosis:"})," ",t.diagnosis]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("strong",{children:"Prescription:"})," ",t.prescription]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[e.jsx("strong",{children:"Date:"})," ",t.date]})]},t.id))}),e.jsxs("div",{className:"mt-6 p-4 bg-white rounded-xl shadow border border-slate-100",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Create Prescription"}),e.jsx(R,{})]}),!l.length&&!n&&e.jsx("p",{className:"text-center text-gray-500 mt-10",children:"No medical records available yet."})]})};export{T as default};
