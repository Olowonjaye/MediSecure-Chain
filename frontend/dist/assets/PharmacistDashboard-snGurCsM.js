import{a as s,j as e,f as b,B as w,C as N,c as y}from"./index-nTQIyIYe.js";import{B as c,C as v}from"./button-C8d14KLS.js";import{Q as o}from"./react-toastify.esm-UE-0H8Ct.js";import{P as C}from"./PrescriptionForm-4hZsIAJW.js";import"./hospitalApi-BvT66DJ5.js";const R=()=>{const[a,P]=s.useState(""),[n,d]=s.useState([]),[i,l]=s.useState(!1),[A,m]=s.useState(!1),x="0xaCA3eF3906639995Fb31Bd58dbcDD0d3CFa2abE8",p=async()=>{try{if(l(!0),!window.ethereum){o.error("No Ethereum provider found. Please connect your wallet.");return}const f=await new w(window.ethereum).getSigner(),u=(await new N(x,y,f).getAllPrescriptions()).map((r,j)=>({id:j+1,patient:r.patient,doctor:r.doctor,medication:r.medication,dosage:r.dosage,date:new Date(Number(r.timestamp)*1e3).toLocaleString()}));d(u)}catch(t){console.error("Error fetching prescriptions:",t),o.error("Failed to load prescription records.")}finally{l(!1)}},h=async()=>{try{const t=await b.get("/api/prescriptions").catch(()=>({data:[]}));d(Array.isArray(t.data)?t.data:[])}catch(t){console.warn("Failed to fetch backend prescriptions",t.message||t)}},g=()=>{navigator.clipboard.writeText(a),m(!0),o.success("Wallet address copied!"),setTimeout(()=>m(!1),2e3)};return s.useEffect(()=>{},[]),s.useEffect(()=>{h()},[]),e.jsxs("div",{className:"p-6 min-h-screen bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-emerald-700",children:"ðŸ’Š Pharmacist Dashboard"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-sm text-gray-600 truncate max-w-[180px]",children:a||"Not Connected"}),e.jsx(c,{onClick:g,variant:"outline",size:"icon",children:e.jsx(v,{size:16})})]})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx(c,{onClick:p,disabled:i,children:i?"Loading...":"View Prescriptions"}),e.jsx(c,{onClick:h,variant:"outline",children:"Refresh (Backend)"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(t=>e.jsxs("div",{className:"bg-white rounded-xl shadow p-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800",children:["Patient: ",t.patient]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("strong",{children:"Prescribed by:"})," ",t.doctor]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("strong",{children:"Medication:"})," ",t.medication]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Dosage:"})," ",t.dosage]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[e.jsx("strong",{children:"Date:"})," ",t.date]})]},t.id))}),e.jsxs("div",{className:"mt-6 p-4 bg-white rounded-xl shadow border border-slate-100",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Create Prescription"}),e.jsx(C,{})]}),!n.length&&!i&&e.jsx("p",{className:"text-center text-gray-500 mt-10",children:"No prescription data available yet."})]})};export{R as default};
