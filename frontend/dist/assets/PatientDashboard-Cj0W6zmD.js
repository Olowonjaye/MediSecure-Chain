import{i as P,u as D,a as i,j as e}from"./index-nTQIyIYe.js";import R from"./EHRForm-B6JoKlBn.js";import L from"./Records-hpGloX6Y.js";import{h}from"./hospitalApi-BvT66DJ5.js";import"./react-toastify.esm-UE-0H8Ct.js";function H(){return"tmp_"+Math.random().toString(36).slice(2,10)+Date.now().toString(36).slice(-4)}function M(){var N,y;const{user:l}=P(),{addToast:n}=D(),[t,v]=i.useState(null),[T,w]=i.useState([]),[m,u]=i.useState(""),[o,d]=i.useState({name:"",phone:"",email:"",address:""}),[c,f]=i.useState(null),[g,b]=i.useState(!1),[x,j]=i.useState(null);i.useEffect(()=>{l&&v({name:l.name||"Patient",email:l.email||"",id:l.id||l.address||"N/A",dob:l.dob||"",gender:l.gender||"",allergies:l.allergies||[],medications:l.medications||[]})},[l]),i.useEffect(()=>{(async()=>{try{t&&t.id}catch(s){console.warn(s)}})()},[t]);const E=()=>{if(!navigator.geolocation)return n("Geolocation not supported in this browser","error");navigator.geolocation.getCurrentPosition(s=>{const a={lat:s.coords.latitude,lng:s.coords.longitude};f(a),n("Location captured","success")},s=>{console.warn(s),n("Unable to get location","error")})},C=async()=>{if(!o||!o.phone&&!o.email)return n("Please provide at least a phone or email for emergency contact","error");b(!0);const s=H(),a={patientId:(t==null?void 0:t.id)||"unknown",contact:o,location:c,tempAccessToken:s};try{await h.sendEmergencyNotification(a),j({sent:!0,payload:a}),n("Emergency notification sent","success")}catch(r){console.warn("Emergency notify failed, simulating",r),j({sent:!1,payload:a}),n("Emergency notification simulated (no backend)","info")}finally{b(!1)}},S=async(s,a,r)=>{if(!t||!t.id)return n("No patient selected","error");try{const p=await h.createAppointment(t.id,{role:s,date:a,notes:r});n("Appointment requested","success"),w(A=>[...A||[],p])}catch(p){console.warn(p),n("Appointment request failed","error")}},k=async()=>{if(!m)return n("Please enter a complaint","error");try{const s=await h.lodgeComplaint((t==null?void 0:t.id)||"unknown",{message:m});n("Complaint lodged","success"),u("")}catch(s){console.warn(s),n("Failed to lodge complaint","error")}};return e.jsxs("div",{className:"p-6 min-h-screen bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-800",children:"ðŸ‘¤ Patient Dashboard"}),e.jsx("div",{className:"text-sm text-slate-600",children:t==null?void 0:t.email})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsxs("div",{className:"p-4 bg-white rounded-xl shadow border border-slate-100",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Profile"}),e.jsxs("p",{className:"text-sm text-slate-700",children:[e.jsx("strong",{children:"Name:"})," ",t==null?void 0:t.name]}),e.jsxs("p",{className:"text-sm text-slate-700",children:[e.jsx("strong",{children:"ID:"})," ",t==null?void 0:t.id]}),e.jsxs("p",{className:"text-sm text-slate-700",children:[e.jsx("strong",{children:"DOB:"})," ",(t==null?void 0:t.dob)||"â€”"]}),e.jsxs("p",{className:"text-sm text-slate-700",children:[e.jsx("strong",{children:"Gender:"})," ",(t==null?void 0:t.gender)||"â€”"]}),e.jsx("hr",{className:"my-3"}),e.jsx("h3",{className:"text-sm font-medium mb-1",children:"Allergies"}),(N=t==null?void 0:t.allergies)!=null&&N.length?e.jsx("ul",{className:"list-disc ml-5 text-sm text-slate-600",children:t.allergies.map((s,a)=>e.jsx("li",{children:s},a))}):e.jsx("p",{className:"text-xs text-slate-500",children:"No allergies recorded."}),e.jsx("h3",{className:"text-sm font-medium mt-3 mb-1",children:"Medications"}),(y=t==null?void 0:t.medications)!=null&&y.length?e.jsx("ul",{className:"list-disc ml-5 text-sm text-slate-600",children:t.medications.map((s,a)=>e.jsx("li",{children:s},a))}):e.jsx("p",{className:"text-xs text-slate-500",children:"No medications recorded."})]}),e.jsxs("div",{className:"mt-4 p-4 bg-white rounded-xl shadow border border-slate-100",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Upcoming Appointments"}),e.jsx("p",{className:"text-sm text-slate-500",children:"No upcoming appointments. Use the hospital scheduling system to book a visit."})]})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"p-4 bg-white rounded-xl shadow border border-slate-100 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Health Summary & EHR"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Create or view structured EHR entries. Entries are encrypted and can be registered on-chain or stored in the hospital EHR backend depending on configuration."}),e.jsx(R,{})]}),e.jsxs("div",{className:"p-4 bg-white rounded-xl shadow border border-slate-100 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Appointments"}),e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"Book an appointment with a hospital role."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 mb-3",children:[e.jsxs("select",{id:"apptRole",className:"border px-2 py-1 rounded",children:[e.jsx("option",{value:"doctor",children:"Doctor"}),e.jsx("option",{value:"consultant",children:"Consultant"}),e.jsx("option",{value:"lab",children:"Lab Scientist"}),e.jsx("option",{value:"nurse",children:"Nurse"}),e.jsx("option",{value:"pharmacist",children:"Pharmacist"}),e.jsx("option",{value:"admin",children:"Hospital Admin"})]}),e.jsx("input",{id:"apptDate",type:"datetime-local",className:"border px-2 py-1 rounded"}),e.jsx("input",{id:"apptNote",placeholder:"Reason / notes",className:"border px-2 py-1 rounded"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>{const s=document.getElementById("apptRole").value,a=document.getElementById("apptDate").value,r=document.getElementById("apptNote").value;S(s,a,r)},className:"px-3 py-1 bg-indigo-600 text-white rounded",children:"Request Appointment"})})]}),e.jsxs("div",{className:"p-4 bg-white rounded-xl shadow border border-slate-100 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Patient Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Emergency Contact & Location"}),e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:'Provide an emergency contact. Use "Send Emergency" to notify them with a temporary access token.'}),e.jsx("input",{placeholder:"Contact name",value:o.name,onChange:s=>d({...o,name:s.target.value}),className:"w-full border px-2 py-1 rounded mb-2"}),e.jsx("input",{placeholder:"Phone",value:o.phone,onChange:s=>d({...o,phone:s.target.value}),className:"w-full border px-2 py-1 rounded mb-2"}),e.jsx("input",{placeholder:"Email",value:o.email,onChange:s=>d({...o,email:s.target.value}),className:"w-full border px-2 py-1 rounded mb-2"}),e.jsx("input",{placeholder:"Address",value:o.address,onChange:s=>d({...o,address:s.target.value}),className:"w-full border px-2 py-1 rounded mb-2"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:E,className:"px-3 py-1 bg-slate-700 text-white rounded",children:"Detect Location"}),e.jsx("button",{onClick:C,disabled:g,className:"px-3 py-1 bg-red-600 text-white rounded",children:g?"Sending...":"Send Emergency"})]}),c&&e.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:["Location: ",c.lat.toFixed(5),", ",c.lng.toFixed(5)]}),x&&e.jsxs("div",{className:"mt-3 p-2 bg-slate-50 border rounded text-sm",children:[e.jsx("div",{children:e.jsx("strong",{children:"Simulated Notification"})}),e.jsx("pre",{className:"text-xs whitespace-pre-wrap",children:JSON.stringify(x.payload,null,2)}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:x.sent?"Sent via backend":"Displayed (no backend)"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Lodge a Complaint"}),e.jsx("textarea",{value:m,onChange:s=>u(s.target.value),rows:5,className:"w-full border px-2 py-1 rounded mb-2",placeholder:"Describe your issue..."}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:k,className:"px-3 py-1 bg-amber-600 text-white rounded",children:"Submit Complaint"})})]})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-xl shadow border border-slate-100",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Medical Records"}),e.jsx("p",{className:"text-sm text-slate-500 mb-3",children:"Secure records (documents, lab reports, prescriptions) associated with this patient."}),e.jsx(L,{})]})]})]})]})}export{M as default};
