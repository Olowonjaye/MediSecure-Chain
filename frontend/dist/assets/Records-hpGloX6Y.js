import{g as b,j as e,a as p,B as y,C as R,c as k}from"./index-nTQIyIYe.js";import{Q as m}from"./react-toastify.esm-UE-0H8Ct.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]],w=b("clipboard",C);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],D=b("external-link",I);function S({title:l,cid:n,resourceId:d}){const i=(t,r)=>{navigator.clipboard.writeText(t),m.success(`${r} copied to clipboard!`)},c="https://console.storacha.network",o=t=>{const x=`${c.replace(/\/$/,"")}/ipfs/${t}`;window.open(x,"_blank")};return e.jsxs("div",{className:"p-5 bg-white rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-3 truncate",children:l||"Untitled Record"}),e.jsxs("div",{className:"space-y-2 text-sm text-slate-600",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-slate-700",children:"CID:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"truncate max-w-[120px]",children:n||"N/A"}),e.jsx("button",{onClick:()=>i(n,"CID"),className:"text-indigo-500 hover:text-indigo-700",title:"Copy CID",children:e.jsx(w,{size:16})}),n&&e.jsx("button",{onClick:()=>o(n),className:"text-green-500 hover:text-green-700",title:"View on IPFS",children:e.jsx(D,{size:16})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-slate-700",children:"Resource ID:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"truncate max-w-[120px]",children:d||"N/A"}),e.jsx("button",{onClick:()=>i(d,"Resource ID"),className:"text-indigo-500 hover:text-indigo-700",title:"Copy Resource ID",children:e.jsx(w,{size:16})})]})]})]}),e.jsx("div",{className:"mt-4 text-right",children:e.jsx("button",{onClick:()=>m.info("Decrypt & View Record feature coming soon"),className:"px-3 py-1.5 text-sm font-medium text-white bg-ms-accent hover:bg-ms-accent-600 rounded-lg shadow",children:"View Record"})})]})}function M(){const[l,n]=p.useState([]),[d,i]=p.useState(!1);return p.useEffect(()=>{(async()=>{try{if(i(!0),!window.ethereum){m.error("Please connect to MetaMask to view records."),i(!1);return}const o=new y(window.ethereum),t=new R("0xaCA3eF3906639995Fb31Bd58dbcDD0d3CFa2abE8",k,o);let r=[];if(t.filters&&typeof t.filters.ResourceRegistered=="function"){const s=t.filters.ResourceRegistered();r=await t.queryFilter(s,0,"latest")}else try{r=await t.queryFilter({},0,"latest")}catch(s){console.warn("No event filters available",s),r=[]}const x=[];for(let s=0;s<r.length;s++){const h=r[s],a=h.args||[],u=a.resourceId||a[0],N=a.owner||a[1],j=a.cid||a[2]||"",v=a.metadata||a[4]||"";let f=new Date().toLocaleString();try{if(h.blockNumber&&o.getBlock){const g=await o.getBlock(h.blockNumber);f=new Date(Number(g.timestamp)*1e3).toLocaleString()}}catch{}x.push({id:s+1,title:v||`Record #${s+1}`,cid:j,resourceId:u?String(u):"",owner:N||"",timestamp:f})}n(x.reverse())}catch(o){console.error("Error fetching records:",o),m.error("Failed to load encrypted records.")}finally{i(!1)}})()},[]),e.jsxs("div",{className:"p-6 bg-white rounded-2xl shadow-sm border border-slate-100",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-slate-700",children:"Patient Records"}),d?e.jsx("div",{className:"text-center text-slate-500 py-10 animate-pulse",children:"Loading records from blockchainâ€¦"}):l.length===0?e.jsx("div",{className:"text-center text-slate-500 py-10",children:"No records found on MediSecure chain."}):e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(c=>e.jsx(S,{title:c.title,cid:c.cid,resourceId:c.resourceId},c.id))})]})}export{M as default};
