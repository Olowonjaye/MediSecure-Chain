const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Audit-DVjJ3IjG.js","assets/index-B6T-XhSG.js","assets/index-BxoHPfe5.css","assets/react-toastify.esm-CR3KtYOa.js"])))=>i.map(i=>d[i]);
import{r,u as b,j as e,B as j,C as N,c as w,_ as y}from"./index-B6T-XhSG.js";import{c as v}from"./api-BmIVOgyt.js";import p from"./AccessControl-DXFEvBCE.js";import{R}from"./RecordCard-DD-iK0fi.js";import{Q as f}from"./react-toastify.esm-CR3KtYOa.js";function A(){const[t,i]=r.useState(null),[l,u]=r.useState(""),[c,n]=r.useState(!1),{addToast:s}=b(),m=d=>{i(d.target.files[0])},x=async d=>{if(d.preventDefault(),!t||!l){setToast({message:"Please select a file and enter patient name",type:"error"});return}try{n(!0),s("Uploading record securely...","info");const o=new FormData;o.append("patientName",l),o.append("fileName",t.name);const a=await v({patientName:l,fileName:t.name});a?(s(`Record uploaded successfully. id: ${a.id||"ok"}`,"success"),i(null),u("")):s("Upload failed","error")}catch(o){console.error(o),s("Error during upload","error")}finally{n(!1)}};return e.jsxs("div",{className:"p-4 bg-white rounded-2xl border border-slate-100 shadow-sm",children:[e.jsx("h3",{className:"text-slate-800 font-semibold mb-3 text-base",children:"Secure Record Upload"}),e.jsx("p",{className:"text-slate-500 text-sm mb-4",children:"Encrypt and store medical records safely on decentralized storage."}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"Patient Name"}),e.jsx("input",{type:"text",value:l,onChange:d=>u(d.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-300 focus:outline-none",placeholder:"Enter patient's full name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"Select File"}),e.jsx("input",{type:"file",onChange:m,className:"w-full text-slate-700 text-sm",accept:".pdf,.jpg,.png,.docx",required:!0})]}),e.jsx("button",{type:"submit",disabled:c,className:`w-full py-2 rounded-lg text-white font-medium transition-all duration-200 ${c?"bg-indigo-300 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 shadow-sm"}`,children:c?"Uploading...":"Upload Record"})]}),e.jsx("div",{className:"mt-3 text-xs text-slate-400 italic",children:"ðŸ”’ All uploads are encrypted before storage and linked to blockchain for verifiable authenticity."})]})}const g=r.lazy(()=>y(()=>import("./Audit-DVjJ3IjG.js"),__vite__mapDeps([0,1,2,3])));function P({active:t="dashboard"}){const[i,l]=r.useState([]),[u,c]=r.useState(!1),n="0x8576E2D1bF399Ae7E41167458a3866E9efD1Ce4A";return r.useEffect(()=>{(async()=>{if(t==="records")try{if(!window.ethereum){f.error("MetaMask not detected!");return}c(!0);const m=new j(window.ethereum),x=new N(n,w,m),d=await x.getRecordCount(),o=[];for(let a=0;a<d;a++){const h=await x.getRecordByIndex(a);o.push({id:a+1,title:h.title||`Record #${a+1}`,cid:h.cid,resourceId:h.resourceId})}l(o.reverse())}catch(m){console.error("Error fetching records:",m),f.error("Failed to load encrypted records.")}finally{c(!1)}})()},[t,n]),t==="records"?e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800 mb-4",children:"Encrypted Medical Records"}),u?e.jsx("div",{className:"text-gray-500 text-center mt-6",children:"Loading recordsâ€¦"}):i.length===0?e.jsx("div",{className:"text-gray-500 text-center mt-6",children:"No encrypted records found on the blockchain."}):e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(s=>e.jsx(R,{title:s.title,cid:s.cid,resourceId:s.resourceId},s.id))})]}):t==="access"?e.jsxs("div",{className:"p-6 bg-white rounded-2xl shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-slate-700",children:"Manage Access Permissions"}),e.jsx(p,{})]}):t==="audit"?e.jsxs("div",{className:"p-6 bg-white rounded-2xl shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-slate-700",children:"Blockchain Audit Trail"}),e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"text-slate-500",children:"Loading Auditâ€¦"}),children:e.jsx(g,{})})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-6 bg-white rounded-2xl shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-slate-700",children:"Upload New Patient Record"}),e.jsx(A,{})]}),e.jsxs("div",{className:"p-6 bg-white rounded-2xl shadow-sm",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-slate-700",children:"Access & Audit Overview"}),e.jsx(p,{}),e.jsx("div",{className:"mt-4",children:e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"text-slate-500",children:"Loading Auditâ€¦"}),children:e.jsx(g,{})})})]})]})})}export{P as default};
