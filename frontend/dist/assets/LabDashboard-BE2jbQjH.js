import{a,u as w,j as e,f as N,B as v,C as R,c as C}from"./index-nTQIyIYe.js";import{B as x,C as L}from"./button-C8d14KLS.js";import{Q as h}from"./react-toastify.esm-UE-0H8Ct.js";import{h as S}from"./hospitalApi-BvT66DJ5.js";function T({patientId:r}){const[u,i]=a.useState(""),[o,c]=a.useState(""),[n,b]=a.useState(""),{addToast:l}=w(),d=async s=>{s.preventDefault();try{await S.postEHR(r||"unknown",{type:"lab",testType:u,result:o,notes:n,timestamp:new Date().toISOString()}),l("Lab result recorded","success")}catch(p){console.error(p),l("Failed to record lab result","error")}};return e.jsxs("form",{onSubmit:d,className:"space-y-3",children:[e.jsx("input",{placeholder:"Test type (e.g. CBC)",value:u,onChange:s=>i(s.target.value),className:"border p-2 w-full"}),e.jsx("textarea",{placeholder:"Result summary",value:o,onChange:s=>c(s.target.value),className:"border p-2 w-full"}),e.jsx("textarea",{placeholder:"Notes",value:n,onChange:s=>b(s.target.value),className:"border p-2 w-full"}),e.jsx("button",{className:"px-4 py-2 bg-indigo-600 text-white rounded",children:"Save Lab Result"})]})}const I=()=>{const[r,u]=a.useState(""),[i,o]=a.useState([]),[c,n]=a.useState(!1),[b,l]=a.useState(!1),d="0xaCA3eF3906639995Fb31Bd58dbcDD0d3CFa2abE8",s=async()=>{try{if(n(!0),!window.ethereum){h.error("No Ethereum provider found. Please connect your wallet.");return}const f=await new v(window.ethereum).getSigner(),y=(await new R(d,C,f).getAllLabReports()).map((m,j)=>({id:j+1,patient:m.patient,testType:m.testType,result:m.result,date:new Date(Number(m.timestamp)*1e3).toLocaleString()}));o(y)}catch(t){console.error("Error fetching lab reports:",t),h.error("Failed to fetch lab reports.")}finally{n(!1)}},p=async()=>{try{const t=await N.get("/api/lab/reports").catch(()=>({data:[]}));o(Array.isArray(t.data)?t.data:[])}catch(t){console.warn("Failed to fetch backend lab reports",t.message||t)}},g=()=>{navigator.clipboard.writeText(r),l(!0),h.success("Wallet address copied!"),setTimeout(()=>l(!1),2e3)};return a.useEffect(()=>{},[]),a.useEffect(()=>{p()},[]),e.jsxs("div",{className:"p-6 min-h-screen bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-green-700",children:"ðŸ§ª Laboratory Dashboard"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-sm text-gray-600 truncate max-w-[180px]",children:r||"Not Connected"}),e.jsx(x,{onClick:g,variant:"outline",size:"icon",children:e.jsx(L,{size:16})})]})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx(x,{onClick:s,disabled:c,children:c?"Loading Reports...":"View Lab Reports"}),e.jsx(x,{onClick:p,variant:"outline",children:"Refresh (Backend)"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(t=>e.jsxs("div",{className:"bg-white rounded-xl shadow p-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800",children:["Patient: ",t.patient.slice(0,6),"...",t.patient.slice(-4)]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("strong",{children:"Test Type:"})," ",t.testType]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("strong",{children:"Result:"})," ",t.result]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[e.jsx("strong",{children:"Date:"})," ",t.date]})]},t.id))}),!i.length&&!c&&e.jsx("p",{className:"text-center text-gray-500 mt-10",children:"No lab reports available yet."}),e.jsxs("div",{className:"mt-6 p-4 bg-white rounded-xl shadow border border-slate-100",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Record Lab Result"}),e.jsx(T,{})]})]})};export{I as default};
