import{a as r,u as S,j as e,i as k,f as u}from"./index-nTQIyIYe.js";import{F as A,a as D,b as R,c as U,d as C,e as L}from"./index.esm-etGEnoAm.js";function G(){const[a,l]=r.useState([]),[d,j]=r.useState(!1),{addToast:m}=S();r.useEffect(()=>{const t=localStorage.getItem("medisecure_users");t&&l(JSON.parse(t))},[]);const b=()=>{const t={id:Date.now(),name:"New User",email:"new@example.local",role:"doctor"},h=[...a,t];l(h),localStorage.setItem("medisecure_users",JSON.stringify(h)),m("Demo user added","success")};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"User Management"}),e.jsx("button",{onClick:b,className:"px-3 py-1 bg-indigo-600 text-white rounded",children:"Add Demo User"})]}),e.jsxs("div",{className:"space-y-2",children:[a.map(t=>e.jsxs("div",{className:"p-3 bg-white rounded border",children:[t.name," â€” ",e.jsx("span",{className:"text-sm text-slate-500",children:t.email})," ",e.jsx("span",{className:"ml-2 text-xs text-slate-400",children:t.role})]},t.id)),!a.length&&e.jsx("p",{className:"text-sm text-slate-500",children:"No users found (demo)."})]})]})}const E=()=>{const{user:a,logout:l}=k(),[d,j]=r.useState([]),[m,b]=r.useState([]),[t,h]=r.useState(!0);r.useEffect(()=>{(async()=>{try{const[c,w]=await Promise.all([u.get("/users"),u.get("/audit").catch(()=>({data:[]}))]);j(c.data),b(w.data||[])}catch(c){console.error("AdminDashboard fetch error:",c)}finally{h(!1)}})()},[]);const o=d.reduce((s,c)=>(s[c.role]=(s[c.role]||0)+1,s),{}),[i,N]=r.useState(""),[x,f]=r.useState(""),[p,g]=r.useState(!1),y=async()=>{if(!i||!x)return alert("Resource ID and grantee required");try{g(!0);const s=await u.post("/access/grant",{resourceId:i,grantee:x});alert("Grant submitted: "+(s.txHash||"ok"))}catch(s){console.error("Grant failed",s),alert("Grant failed: "+(s.message||JSON.stringify(s)))}finally{g(!1)}},v=async()=>{if(!i||!x)return alert("Resource ID and grantee required");try{g(!0);const s=await u.post("/access/revoke",{resourceId:i,grantee:x});alert("Revoke submitted: "+(s.txHash||"ok"))}catch(s){console.error("Revoke failed",s),alert("Revoke failed: "+(s.message||JSON.stringify(s)))}finally{g(!1)}};return t?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading dashboard..."}):e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 border-b pb-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-blue-800",children:"MediSecure Admin Dashboard"}),e.jsx("button",{onClick:l,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg",children:"Logout"})]}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-5 mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-700",children:["Welcome, ",(a==null?void 0:a.name)||"Admin"]}),e.jsxs("p",{className:"text-gray-500",children:["You are logged in as ",e.jsx("strong",{children:a==null?void 0:a.role}),"."]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-8",children:[e.jsx(n,{icon:e.jsx(A,{}),label:"Doctors",count:o.doctor||0}),e.jsx(n,{icon:e.jsx(D,{}),label:"Nurses",count:o.nurse||0}),e.jsx(n,{icon:e.jsx(R,{}),label:"Pharmacists",count:o.pharmacist||0}),e.jsx(n,{icon:e.jsx(U,{}),label:"Lab Scientists",count:o.lab||0}),e.jsx(n,{icon:e.jsx(C,{}),label:"Consultants",count:o.consultant||0}),e.jsx(n,{icon:e.jsx(L,{}),label:"Total Users",count:d.length})]}),e.jsxs("section",{className:"bg-white shadow-md rounded-lg p-5 mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-4",children:"Registered Users"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-700 border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-3 border",children:"Name"}),e.jsx("th",{className:"py-2 px-3 border",children:"Email"}),e.jsx("th",{className:"py-2 px-3 border",children:"Role"}),e.jsx("th",{className:"py-2 px-3 border",children:"Created At"})]})}),e.jsx("tbody",{children:d.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-3 border",children:s.name}),e.jsx("td",{className:"py-2 px-3 border",children:s.email}),e.jsx("td",{className:"py-2 px-3 border capitalize",children:s.role}),e.jsx("td",{className:"py-2 px-3 border",children:new Date(s.createdAt).toLocaleString()})]},s.id))})]})}),e.jsx("div",{className:"mt-4",children:e.jsx(G,{})})]}),e.jsxs("section",{className:"bg-white shadow-md rounded-lg p-5",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-4",children:"System Audit Logs"}),m.length===0?e.jsx("p",{className:"text-gray-500",children:"No audit logs yet."}):e.jsx("div",{className:"max-h-64 overflow-y-auto border rounded-md p-3 text-sm",children:m.map(s=>e.jsxs("div",{className:"border-b py-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:s.type}),": ",s.message]}),e.jsx("p",{className:"text-gray-400 text-xs",children:new Date(s.ts).toLocaleString()})]},s.id))})]}),e.jsxs("section",{className:"bg-white shadow-md rounded-lg p-5 mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-4",children:"Access Control (Grant / Revoke)"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{value:i,onChange:s=>N(s.target.value),placeholder:"resourceId (keccak/hex)",className:"border rounded p-2"}),e.jsx("input",{value:x,onChange:s=>f(s.target.value),placeholder:"grantee address",className:"border rounded p-2"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:y,disabled:p,className:"bg-green-600 text-white px-3 py-2 rounded",children:"Grant"}),e.jsx("button",{onClick:v,disabled:p,className:"bg-red-600 text-white px-3 py-2 rounded",children:"Revoke"})]})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-3",children:"Granting/revoking will call the on-chain AccessManager and persist an audit entry."})]})]})},n=({icon:a,label:l,count:d})=>e.jsxs("div",{className:"flex items-center bg-white rounded-xl shadow p-4 space-x-4",children:[e.jsx("div",{className:"text-blue-600 text-3xl",children:a}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:l}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:d})]})]});export{E as default};
