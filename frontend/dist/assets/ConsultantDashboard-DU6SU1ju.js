import{a,u as N,j as e,i as y,f as m}from"./index-nTQIyIYe.js";import{F as f,f as w,g as v}from"./index.esm-etGEnoAm.js";import{h as C}from"./hospitalApi-BvT66DJ5.js";function S({patientId:r}){const[d,i]=a.useState(""),[x,n]=a.useState(""),{addToast:o}=N(),c=async l=>{l.preventDefault();try{await C.postEHR(r||"unknown",{type:"consultation",reason:d,notes:x,timestamp:new Date().toISOString()}),o("Consultation note saved","success")}catch(h){console.error(h),o("Failed to save consultation note","error")}};return e.jsxs("form",{onSubmit:c,className:"space-y-3",children:[e.jsx("input",{placeholder:"Reason for consultation",value:d,onChange:l=>i(l.target.value),className:"border p-2 w-full"}),e.jsx("textarea",{placeholder:"Consultation notes",value:x,onChange:l=>n(l.target.value),className:"border p-2 w-full"}),e.jsx("button",{className:"px-4 py-2 bg-indigo-600 text-white rounded",children:"Save Note"})]})}const A=()=>{const{user:r,logout:d}=y(),[i,x]=a.useState([]),[n,o]=a.useState(null),[c,l]=a.useState(""),[h,g]=a.useState(!0);a.useEffect(()=>{(async()=>{try{const t=await m.get("/cases/consultant");x(t.data)}catch(t){console.error("Error loading consultant cases:",t)}finally{g(!1)}})()},[]);const[u,p]=a.useState([]);a.useEffect(()=>{(async()=>{try{const t=await m.get("/research/requests").catch(()=>({data:[]}));p(Array.isArray(t.data)?t.data:[])}catch(t){console.warn("Failed to load research requests",t.message||t)}})()},[]);const b=s=>{o(s),l(s.diagnosis||"")},j=async()=>{if(!n)return alert("No case selected.");try{await m.put(`/cases/${n.id}/diagnosis`,{diagnosis:c}),alert("Diagnosis updated successfully."),o({...n,diagnosis:c})}catch(s){console.error("Error saving diagnosis:",s),alert("Failed to update diagnosis.")}};return h?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading consultant dashboard..."}):e.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 border-b pb-3",children:[e.jsxs("h1",{className:"text-2xl font-bold text-blue-800 flex items-center gap-2",children:[e.jsx(f,{})," Consultant Dashboard"]}),e.jsx("button",{onClick:d,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg",children:"Logout"})]}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-5 mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-700",children:["Welcome, ",(r==null?void 0:r.name)||"Consultant"]}),e.jsxs("p",{className:"text-gray-500",children:["You are logged in as ",e.jsx("strong",{children:r==null?void 0:r.role}),"."]})]}),e.jsxs("section",{className:"bg-white shadow-md rounded-lg p-5 mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(w,{})," Assigned Cases"]})}),i.length===0?e.jsx("p",{className:"text-gray-500",children:"No assigned cases found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-700 border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-3 border",children:"Patient"}),e.jsx("th",{className:"py-2 px-3 border",children:"Symptoms"}),e.jsx("th",{className:"py-2 px-3 border",children:"Date Assigned"}),e.jsx("th",{className:"py-2 px-3 border",children:"Action"})]})}),e.jsx("tbody",{children:i.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-3 border",children:s.patientName}),e.jsx("td",{className:"py-2 px-3 border",children:s.symptoms}),e.jsx("td",{className:"py-2 px-3 border",children:new Date(s.assignedAt).toLocaleString()}),e.jsx("td",{className:"py-2 px-3 border",children:e.jsx("button",{onClick:()=>b(s),className:"text-blue-600 hover:underline",children:"View"})})]},s.id))})]})})]}),n&&e.jsxs("section",{className:"bg-white shadow-md rounded-lg p-5",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-700 mb-3",children:[e.jsx(v,{className:"inline-block mr-2"}),"Diagnosis for ",n.patientName]}),e.jsx("textarea",{className:"w-full border rounded-md p-3 text-sm mb-4",rows:6,placeholder:"Write diagnosis notes here...",value:c,onChange:s=>l(s.target.value)}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>o(null),className:"bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-md",children:"Cancel"}),e.jsx("button",{onClick:j,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md",children:"Save Diagnosis"})]})]}),e.jsxs("section",{className:"mt-6 bg-white shadow-md rounded-lg p-5",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Create Consultation Note"}),e.jsx(S,{})]}),e.jsxs("section",{className:"mt-6 bg-white shadow-md rounded-lg p-5",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Research Requests"}),u.length===0?e.jsx("p",{className:"text-gray-500",children:"No research requests at the moment."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-700 border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-3 border",children:"Title"}),e.jsx("th",{className:"py-2 px-3 border",children:"Requester"}),e.jsx("th",{className:"py-2 px-3 border",children:"Status"})]})}),e.jsx("tbody",{children:u.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-3 border",children:s.title}),e.jsx("td",{className:"py-2 px-3 border",children:s.requester}),e.jsx("td",{className:"py-2 px-3 border",children:s.status})]},s.id))})]})})]})]})};export{A as default};
