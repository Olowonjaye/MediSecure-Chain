import{g as b,i as f,a as o,j as e,B as j,C as y,c as N}from"./index-nTQIyIYe.js";import{Q as c}from"./react-toastify.esm-UE-0H8Ct.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],H=b("copy",w),k=()=>{const{user:d}=f(),[i,x]=o.useState([]),[m,g]=o.useState(!0),n="0xaCA3eF3906639995Fb31Bd58dbcDD0d3CFa2abE8";o.useEffect(()=>{(async()=>{try{if(!window.ethereum){c.error("MetaMask not detected!");return}const r=new j(window.ethereum),L=await r.getSigner(),p=(await new y(n,N,r).queryFilter({},0,"latest")).map(t=>{var l,h;const a=t.event||"unknown";return a==="ResourceRegistered"?{id:t.transactionHash,recordId:((l=t.args.resourceId)==null?void 0:l.toString())||"-",updatedBy:t.args.owner||"-",timestamp:new Date((t.blockNumber,Date.now())).toLocaleString(),extra:{cid:t.args.cid,cipherHash:t.args.cipherHash},txHash:t.transactionHash}:a==="AccessGranted"||a==="AccessRevoked"?{id:t.transactionHash,recordId:((h=t.args.resourceId)==null?void 0:h.toString())||"-",updatedBy:t.args.grantee||"-",timestamp:new Date().toLocaleString(),txHash:t.transactionHash}:{id:t.transactionHash,recordId:t.args&&t.args[0]?String(t.args[0]):"-",updatedBy:t.args&&t.args[1]?String(t.args[1]):"-",timestamp:new Date().toLocaleString(),txHash:t.transactionHash}});x(p.reverse())}catch(r){console.error("Error fetching audit logs:",r),c.error("Failed to load audit logs")}finally{g(!1)}})()},[n]);const u=s=>{navigator.clipboard.writeText(s),c.success("Copied to clipboard!")};return e.jsxs("div",{className:"p-6 bg-white rounded-xl shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-600 mb-4",children:"ðŸ§¾ Audit Trail"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"View all activity logs from the blockchain ledger. Every modification to medical records is transparently stored for accountability."}),m?e.jsx("p",{className:"text-gray-500 text-center",children:"Loading audit logs..."}):i.length===0?e.jsx("p",{className:"text-gray-500 text-center",children:"No audit records found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-300 rounded-lg",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100",children:[e.jsx("th",{className:"p-3 text-left text-sm font-semibold border",children:"#"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold border",children:"Record ID"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold border",children:"Updated By"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold border",children:"Timestamp"}),e.jsx("th",{className:"p-3 text-left text-sm font-semibold border",children:"Transaction Hash"})]})}),e.jsx("tbody",{children:i.map((s,r)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 border",children:r+1}),e.jsx("td",{className:"p-3 border",children:s.recordId}),e.jsx("td",{className:"p-3 border text-gray-700",children:s.updatedBy}),e.jsx("td",{className:"p-3 border text-gray-600",children:s.timestamp}),e.jsxs("td",{className:"p-3 border text-blue-600 flex items-center gap-2",children:[e.jsx("span",{className:"truncate w-40",children:s.txHash}),e.jsx("button",{onClick:()=>u(s.txHash),className:"p-1 rounded-full hover:bg-blue-200",children:e.jsx(H,{size:16})})]})]},s.id))})]})}),d&&e.jsx("div",{className:"mt-8 border-t pt-4",children:e.jsxs("h3",{className:"text-gray-700 font-semibold",children:["Logged in as: ",e.jsx("span",{className:"text-blue-500",children:d.role})]})})]})};export{k as default};
